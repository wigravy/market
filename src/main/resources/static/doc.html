<!doctype html>
<html ng-app="cartScript">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</head>
<body ng-controller="cartScriptCtrl">
<div class="container">
    <h2>Market cart</h2>
    <h3>Add new product</h3>
    <form name="addNewProductForm" ng-submit="create()">
        <label>Title:</label>
        <input id="newProductTitle" type="text" ng-model="newProduct.title" placeholder="Product title">
        <label>Price:</label>
        <input id="newProductPrice" type="text" ng-model="newProduct.price" placeholder="Product cost">
        <button id="submitNewProductBtn" class="btn btn-primary" type="submit">Create</button>
    </form>


    <h3>Products:</h3>
    <button id="refreshBtn" class="btn btn-dark" ng-click="getAllProducts()">Refresh products list</button>
    <table id="productsTbl" class="table table-hover">
        <thead>
        <tr>
            <th>Id</th>
            <th>Title</th>
            <th>Price</th>
            <th>Operation</th>
        </tr>
        </thead>
        <tbody ng-repeat="product in Products | orderBy : 'id'">
        <tr>
            <td>{{product.id}}</td>
            <td>{{product.title}}</td>
            <td>{{product.price}}</td>
            <td>
                <button>Delete</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
<script>
    let cartScript = angular.module('cartScript', []);

    cartScript.controller('cartScriptCtrl', function ($scope, $http) {
        $scope.getAllProducts = () => {
            $http({
                method: 'GET',
                url: 'http://localhost:8189/market/api/v1/products'
            }).then(function success(response) {
                $scope.Products = response.data;
            }, function error(response) {
                console.error(response);
            });
        };

        $scope.create = () => {
            $http({
                method: 'POST',
                url: 'http://localhost:8189/market/api/v1/products',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: $scope.newProduct
            }).then(function success(response) {
                $scope.Products.push(response.data);
                $scope.newProduct.title = '';
                $scope.newProduct.price = '';
            }, function error(response) {
                console.error(response);
            });
        };

        $scope.deleteProduct = (id) => {
            $http({
                method: 'DELETE',
                url: 'http://localhost:8189/market/api/v1/products/' + id
            }).then(function success(response) {

            }, function error(response) {
                console.error(response);
            });
        };


    });
</script>
</html>